<!DOCTYPE html><html lang='en'><head><title>[module.context]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>10</a> Modules <a class='abbr_ref' href='./#module'>[module]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>10.6</a> Instantiation context <a class='abbr_ref'>[module.context]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L863'>#</a></div><div id='1.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:instantiation_context' id='def:instantiation_context'><i >instantiation context</i></a> is a set of points within the program
that determines which names are visible
to argument-dependent name lookup (<a href='basic.lookup.argdep'>[basic.lookup.argdep]</a>)
and which declarations are reachable (<a href='module.reach'>[module.reach]</a>)
in the context of a particular declaration or template instantiation<a class='hidden_link' href='#1.sentence-1'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L870'>#</a></div><div id='2.sentence-1' class='sentence'>During the implicit definition of
a defaulted function (<a href='special'>[special]</a>, <a href='class.compare.default'>[class.compare.default]</a>),
the instantiation context is the union of
the instantiation context from the definition of the class and
the instantiation context of the program construct that
resulted in the implicit definition of the defaulted function<a class='hidden_link' href='#2.sentence-1'>.</a></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L878'>#</a></div><div id='3.sentence-1' class='sentence'>During the implicit instantiation of a template
whose point of instantiation is specified as
that of an enclosing specialization (<a href='temp.point'>[temp.point]</a>),
the instantiation context is the union of
the instantiation context of the enclosing specialization and,
if the template is defined in a module interface unit of a module <span class='math'><span class='mathalpha'>M</span></span>
and the point of instantiation is not in a module interface unit of <span class='math'><span class='mathalpha'>M</span></span>,
the point at the end of the
<a class='grammarterm' href='dcl.pre#nt:declaration-seq'>declaration-seq</a> of the
primary module interface unit of <span class='math'><span class='mathalpha'>M</span></span>
(prior to the <a class='grammarterm' href='module.private.frag#nt:private-module-fragment'>private-module-fragment</a>, if any)<a class='hidden_link' href='#3.sentence-1'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L891'>#</a></div><div id='4.sentence-1' class='sentence'>During the implicit instantiation of a template
that is implicitly instantiated because it is referenced
from within the implicit definition of a defaulted function,
the instantiation context is the instantiation context of
the defaulted function<a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L898'>#</a></div><div id='5.sentence-1' class='sentence'>During the instantiation of any other template specialization,
the instantiation context comprises the point of instantiation
of the template<a class='hidden_link' href='#5.sentence-1'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L903'>#</a></div><div id='6.sentence-1' class='sentence'>In any other case, the instantiation context
at a point within the program
comprises that point<a class='hidden_link' href='#6.sentence-1'>.</a></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/modules.tex#L908'>#</a></div><div id='7.example-1' class='example'>[&nbsp;<a class='example_link' href='#7.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <p>Translation unit #1:<pre class='codeblock'>
<span class='keyword'>export</span> <span class='keyword'>module</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T, <span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> foo<span class='parenthesis'>(</span>T, U u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>auto</span> v <span class='operator'>=</span> u; <span class='curlybracket'>}</span>
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T, <span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> bar<span class='parenthesis'>(</span>T, U u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>auto</span> v <span class='operator'>=</span> <span class='operator'>*</span>u; <span class='curlybracket'>}</span>
</pre><p>Translation unit #2:<pre class='codeblock'>
<span class='keyword'>export</span> <span class='keyword'>module</span> M1;
<span class='keyword'>import</span> <span class='literal'>"defn.h"</span>;        <span class='comment'>// provides <span class='tcode_in_codeblock'>struct X {};</span></span>
<span class='keyword'>import</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  X x;
  foo<span class='parenthesis'>(</span>t, x<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre><p>Translation unit #3:<pre class='codeblock'>
<span class='keyword'>export</span> <span class='keyword'>module</span> M2;
<span class='keyword'>import</span> <span class='literal'>"decl.h"</span>;        <span class='comment'>// provides <span class='tcode_in_codeblock'>struct X;</span> (not a definition)</span>
<span class='keyword'>import</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  X <span class='operator'>*</span>x;
  bar<span class='parenthesis'>(</span>t, x<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre><p>Translation unit #4:<pre class='codeblock'>
<span class='keyword'>import</span> M1;
<span class='keyword'>import</span> M2;
<span class='keyword'>void</span> test<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;
  g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre> <div id='7.sentence-1' class='sentence'>
The call to <span class='texttt'>f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span> is valid;
the instantiation context of <span class='texttt'>foo<span class='anglebracket'>&lt;</span><span class='keyword'>int</span>, X<span class='anglebracket'>&gt;</span></span> comprises
<ul class='itemize'><li >the point at the end of translation unit #1,</li><li >the point at the end of translation unit #2, and</li><li >the point of the call to <span class='texttt'>f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span>,</li></ul>
so the definition of <span class='texttt'>X</span> is reachable (<a href='module.reach'>[module.reach]</a>)<a class='hidden_link' href='#7.sentence-1'>.</a></div><div style='height:0.6em;display:block'></div><div id='7.sentence-2' class='sentence'>It is unspecified whether the call to <span class='texttt'>g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span> is valid:
the instantiation context of <span class='texttt'>bar<span class='anglebracket'>&lt;</span><span class='keyword'>int</span>, X<span class='anglebracket'>&gt;</span></span> comprises
<ul class='itemize'><li >the point at the end of translation unit #1,</li><li >the point at the end of translation unit #3, and</li><li >the point of the call to <span class='texttt'>g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span>,</li></ul>
so the definition of <span class='texttt'>X</span> need not be reachable,
as described in <a href='module.reach'>[module.reach]</a><a class='hidden_link' href='#7.sentence-2'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div></body></html>