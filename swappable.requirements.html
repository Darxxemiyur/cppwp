<!DOCTYPE html><html lang='en'><head><title>[swappable.requirements]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>16</a> Library introduction <a class='abbr_ref' href='./#library'>[library]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>16.5</a> Library-wide requirements <a class='abbr_ref' href='requirements#swappable.requirements'>[requirements]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>16.5.3</a> Requirements on types and expressions <a class='abbr_ref' href='utility.requirements#swappable.requirements'>[utility.requirements]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>16.5.3.2</a> Swappable requirements <a class='abbr_ref'>[swappable.requirements]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1754'>#</a></div><div id='1.sentence-1' class='sentence'>This subclause provides definitions for swappable types and expressions<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>In these
definitions, let <span class='texttt'>t</span> denote an expression of type <span class='texttt'>T</span>, and let <span class='texttt'>u</span>
denote an expression of type <span class='texttt'>U</span><a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1759'>#</a></div><div id='2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> is <a class='hidden_link' href='#def:swappable_with' id='def:swappable_with'><i >swappable with</i></a> an object <span class='texttt'>u</span> if and only if:
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div>the expressions <span class='texttt'>swap<span class='parenthesis'>(</span>t, u<span class='parenthesis'>)</span></span> and <span class='texttt'>swap<span class='parenthesis'>(</span>u, t<span class='parenthesis'>)</span></span> are valid when
evaluated in the context described below, and</li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div>these expressions have the following effects:<ul class='itemize'><li id='2.2.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#2.2.1'>(2.2.1)</a></div>the object referred to by <span class='texttt'>t</span> has the value originally held by <span class='texttt'>u</span> and</li><li id='2.2.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#2.2.2'>(2.2.2)</a></div>the object referred to by <span class='texttt'>u</span> has the value originally held by <span class='texttt'>t</span>.</li></ul></li></ul></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1773'>#</a></div><div id='3.sentence-1' class='sentence'>The context in which <span class='texttt'>swap<span class='parenthesis'>(</span>t, u<span class='parenthesis'>)</span></span> and <span class='texttt'>swap<span class='parenthesis'>(</span>u, t<span class='parenthesis'>)</span></span> are evaluated shall
ensure that a binary non-member function named “swap” is selected via <a href='over.match'>overload
resolution</a> on a candidate set that includes:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.1'>(3.1)</a></div>the two <span class='texttt'>swap</span> function templates defined in
<span class='indexparent'><a class='index' id=':<utility>'></a></span><span class='texttt'><span class='anglebracket'>&lt;</span>utility<span class='anglebracket'>&gt;</span></span> (<a href='utility.syn'>[utility.syn]</a>) and</li><li id='3.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.2'>(3.2)</a></div>the lookup set produced by <a href='basic.lookup.argdep'>argument-dependent lookup</a><a class='hidden_link' href='#3.sentence-1'>.</a></li></ul></div> <div id='3.note-1' class='note'>[&nbsp;<a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-2' class='sentence'>If <span class='texttt'>T</span> and <span class='texttt'>U</span> are both fundamental types or arrays of
fundamental types and the declarations from the header <span class='indexparent'><a class='index' id=':<utility>_'></a></span><span class='texttt'><span class='anglebracket'>&lt;</span>utility<span class='anglebracket'>&gt;</span></span> are in
scope, the overall lookup set described above is equivalent to that of the
qualified name lookup applied to the expression <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>swap<span class='parenthesis'>(</span>t, u<span class='parenthesis'>)</span></span> or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>swap<span class='parenthesis'>(</span>u, t<span class='parenthesis'>)</span></span> as appropriate<a class='hidden_link' href='#3.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='3.note-2' class='note'>[&nbsp;<a class='note_link' href='#3.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-3' class='sentence'>It is unspecified whether a library component that has a swappable
requirement includes the header <span class='indexparent'><a class='index' id=':<utility>__'></a></span><span class='texttt'><span class='anglebracket'>&lt;</span>utility<span class='anglebracket'>&gt;</span></span> to ensure an appropriate
evaluation context<a class='hidden_link' href='#3.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1796'>#</a></div><div id='4.sentence-1' class='sentence'>An rvalue or lvalue <span class='texttt'>t</span> is <a class='hidden_link' href='#def:swappable' id='def:swappable'><i >swappable</i></a> if and only if <span class='texttt'>t</span> is
swappable with any rvalue or lvalue, respectively, of type <span class='texttt'>T</span><a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1800'>#</a></div><div id='5.sentence-1' class='sentence'>A type <span class='texttt'>X</span> meeting any of the iterator requirements (<a href='iterator.requirements'>[iterator.requirements]</a>)
meets the <span class='textit'>Cpp17ValueSwappable</span> requirements if,
for any dereferenceable object
<span class='texttt'>x</span> of type <span class='texttt'>X</span>,
<span class='texttt'><span class='operator'>*</span>x</span> is swappable<a class='hidden_link' href='#5.sentence-1'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lib-intro.tex#L1807'>#</a></div><div id='6.example-1' class='example'>[&nbsp;<a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='6.sentence-1' class='sentence'>User code can ensure that the evaluation of <span class='texttt'>swap</span> calls
is performed in an appropriate context under the various conditions as follows:
<pre class='codeblock'>
<span class='preprocessordirective'>#include</span> <span class='anglebracket'>&lt;</span>utility<span class='anglebracket'>&gt;</span>

<span class='comment'>// Requires: <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;forward&lt;T&gt;(t)</span> shall be swappable with <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;forward&lt;U&gt;(u)</span>.</span>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> U<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> value_swap<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> t, U<span class='operator'>&amp;</span><span class='operator'>&amp;</span> u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> std<span class='operator'>::</span>swap;
  swap<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>u<span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='comment'>// OK: uses “swappable with” conditions</span>
                                                <span class='comment'>// for rvalues and lvalues</span>
<span class='curlybracket'>}</span>

<span class='comment'>// Requires: lvalues of <span class='tcode_in_codeblock'>T</span> shall be swappable.</span>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> lv_swap<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span> t1, T<span class='operator'>&amp;</span> t2<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> std<span class='operator'>::</span>swap;
  swap<span class='parenthesis'>(</span>t1, t2<span class='parenthesis'>)</span>;                                 <span class='comment'>// OK: uses swappable conditions for lvalues of type <span class='tcode_in_codeblock'>T</span></span>
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> N <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> A <span class='curlybracket'>{</span> <span class='keyword'>int</span> m; <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> Proxy <span class='curlybracket'>{</span> A<span class='operator'>*</span> a; <span class='curlybracket'>}</span>;
  Proxy proxy<span class='parenthesis'>(</span>A<span class='operator'>&amp;</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> Proxy<span class='curlybracket'>{</span> <span class='operator'>&amp;</span>a <span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>

  <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>A<span class='operator'>&amp;</span> x, Proxy p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    std<span class='operator'>::</span>swap<span class='parenthesis'>(</span>x<span class='operator'>.</span>m, p<span class='operator'>.</span>a<span class='operator'>-</span><span class='anglebracket'>&gt;</span>m<span class='parenthesis'>)</span>;                     <span class='comment'>// OK: uses context equivalent to swappable</span>
                                                <span class='comment'>// conditions for fundamental types</span>
  <span class='curlybracket'>}</span>
  <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>Proxy p, A<span class='operator'>&amp;</span> x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> swap<span class='parenthesis'>(</span>x, p<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>      <span class='comment'>// satisfy symmetry constraint</span>
<span class='curlybracket'>}</span>

<span class='keyword'>int</span> main<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i <span class='operator'>=</span> <span class='literal'>1</span>, j <span class='operator'>=</span> <span class='literal'>2</span>;
  lv_swap<span class='parenthesis'>(</span>i, j<span class='parenthesis'>)</span>;
  assert<span class='parenthesis'>(</span>i <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>2</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> j <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>;

  N<span class='operator'>::</span>A a1 <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='literal'>5</span> <span class='curlybracket'>}</span>, a2 <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='operator'>-</span><span class='literal'>5</span> <span class='curlybracket'>}</span>;
  value_swap<span class='parenthesis'>(</span>a1, proxy<span class='parenthesis'>(</span>a2<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  assert<span class='parenthesis'>(</span>a1<span class='operator'>.</span>m <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='literal'>5</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> a2<span class='operator'>.</span>m <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>5</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div></body></html>