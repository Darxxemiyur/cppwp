<!DOCTYPE html><html lang='en'><head><title>[temp.constr.normal]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>13</a> Templates <a class='abbr_ref' href='./#temp'>[temp]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>13.5</a> Template constraints <a class='abbr_ref' href='temp.constr#normal'>[temp.constr]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>13.5.3</a> Constraint normalization <a class='abbr_ref'>[temp.constr.normal]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/templates.tex#L1846'>#</a></div><div id='1.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:normal_form,constraint' id='def:normal_form,constraint'><i >normal form</i></a> of an <a class='grammarterm' href='expr.comma#nt:expression'>expression</a> <span class='texttt'>E</span> is
a <a href='temp.constr.constr#def:constraint'>constraint</a> that is defined as follows:
<ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.1'>(1.1)</a></div>The normal form of an expression <span class='texttt'><span class='parenthesis'>(</span> E <span class='parenthesis'>)</span></span> is
the normal form of <span class='texttt'>E</span>.</li><li id='1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.2'>(1.2)</a></div>The normal form of an expression <span class='texttt'>E1 <span class='operator'>|</span><span class='operator'>|</span> E2</span> is
the <a href='temp.constr.op#def:disjunction'>disjunction</a> of
the normal forms of <span class='texttt'>E1</span> and <span class='texttt'>E2</span>.</li><li id='1.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.3'>(1.3)</a></div>The normal form of an expression <span class='texttt'>E1 <span class='operator'>&amp;</span><span class='operator'>&amp;</span> E2</span>
is the conjunction of
the normal forms of <span class='texttt'>E1</span> and <span class='texttt'>E2</span>.</li><li id='1.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.4'>(1.4)</a></div>The normal form of a concept-id <span class='texttt'>C<span class='anglebracket'>&lt;</span>A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span><span class='anglebracket'>&gt;</span></span>
is the normal form of the <a class='grammarterm' href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a> of <span class='texttt'>C</span>,
after substituting <span class='texttt'>A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, A<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> for
<span class='texttt'>C</span>'s respective template parameters in the
parameter mappings in each atomic constraint. If any such substitution results in an invalid type or expression,
the program is ill-formed; no diagnostic is required. <div id='1.4.example-1' class='example'>[&nbsp;<a class='example_link' href='#1.4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> A <span class='operator'>=</span> T<span class='operator'>::</span>value <span class='operator'>|</span><span class='operator'>|</span> <span class='literal'>true</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> B <span class='operator'>=</span> A<span class='anglebracket'>&lt;</span>U<span class='operator'>*</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> V<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C <span class='operator'>=</span> B<span class='anglebracket'>&lt;</span>V<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
</pre> 
Normalization of <span class='texttt'>B</span>'s <a class='grammarterm' href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a>
is valid and results in
<span class='texttt'>T<span class='operator'>&#x200b;::&#x200b;</span>value</span> (with the mapping <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.225em;">T</span></span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">↦</span></span><span class="mjx-texatom MJXc-space3"><span class="mjx-mrow"></span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">U<span class='operator'>*</span></span></span></span></span></span></span></span>)
<span class='math'>∨</span>
<span class='texttt'><span class='literal'>true</span></span> (with an empty mapping),
despite the expression <span class='texttt'>T<span class='operator'>&#x200b;::&#x200b;</span>value</span> being ill-formed
for a pointer type <span class='texttt'>T</span>. Normalization of <span class='texttt'>C</span>'s <a class='grammarterm' href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a>
results in the program being ill-formed,
because it would form the invalid type <span class='texttt'>V<span class='operator'>&amp;</span><span class='operator'>*</span></span>
in the parameter mapping. —&nbsp;<i>end example</i></div>&nbsp;]</div> </li><li id='1.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.5'>(1.5)</a></div>The normal form of any other expression <span class='texttt'>E</span> is
the atomic constraint
whose expression is <span class='texttt'>E</span> and
whose parameter mapping is the identity mapping.</li></ul></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/templates.tex#L1899'>#</a></div><div id='2.sentence-1' class='sentence'>The process of obtaining the normal form of a
<a class='grammarterm' href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a>
is called
<a class='hidden_link' href='#def:constraint,normalization' id='def:constraint,normalization'><i >normalization</i></a><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.note-1' class='note'>[&nbsp;<a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-2' class='sentence'>Normalization of <a class='grammarterm' href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a><span class='textit'>s</span>
is performed
when determining the associated constraints (<a href='temp.constr.constr'>[temp.constr.constr]</a>)
of a declaration
and
when evaluating the value of an <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a>
that names a concept specialization (<a href='expr.prim.id'>[expr.prim.id]</a>)<a class='hidden_link' href='#2.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/templates.tex#L1915'>#</a></div><div id='3.example-1' class='example'>[&nbsp;<a class='example_link' href='#3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C1 <span class='operator'>=</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C2 <span class='operator'>=</span> C1<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='literal'>1</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>2</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C3 <span class='operator'>=</span> <span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> T<span class='operator'>::</span>type; <span class='curlybracket'>}</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C4 <span class='operator'>=</span> <span class='keyword'>requires</span> <span class='parenthesis'>(</span>T x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='operator'>+</span><span class='operator'>+</span>x; <span class='curlybracket'>}</span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span>C2 U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> f1<span class='parenthesis'>(</span>U<span class='parenthesis'>)</span>;      <span class='comment'>// #1</span>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span>C3 U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> f2<span class='parenthesis'>(</span>U<span class='parenthesis'>)</span>;      <span class='comment'>// #2</span>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span>C4 U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> f3<span class='parenthesis'>(</span>U<span class='parenthesis'>)</span>;      <span class='comment'>// #3</span>
</pre> <div id='3.sentence-1' class='sentence'>
The associated constraints of #1 are
<span class='texttt'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span></span> (with mapping <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.225em;">T</span></span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">↦</span></span><span class="mjx-texatom MJXc-space3"><span class="mjx-mrow"></span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">U</span></span></span></span></span></span></span>) <span class='math'>∧</span> <span class='texttt'><span class='literal'>1</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>2</span></span><a class='hidden_link' href='#3.sentence-1'>.</a></div> <br/> <div id='3.sentence-2' class='sentence'>
The associated constraints of #2 are
<span class='texttt'><span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> T<span class='operator'>&#x200b;::&#x200b;</span>type; <span class='curlybracket'>}</span></span> (with mapping <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.225em;">T</span></span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">↦</span></span><span class="mjx-texatom MJXc-space3"><span class="mjx-mrow"></span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">U</span></span></span></span></span></span></span>)<a class='hidden_link' href='#3.sentence-2'>.</a></div> <br/> <div id='3.sentence-3' class='sentence'>
The associated constraints of #3 are
<span class='texttt'><span class='keyword'>requires</span> <span class='parenthesis'>(</span>T x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='operator'>+</span><span class='operator'>+</span>x; <span class='curlybracket'>}</span></span> (with mapping <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.225em;">T</span></span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">↦</span></span><span class="mjx-texatom MJXc-space3"><span class="mjx-mrow"></span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">U</span></span></span></span></span></span></span>)<a class='hidden_link' href='#3.sentence-3'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div></body></html>