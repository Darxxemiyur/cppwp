<!DOCTYPE html><html lang='en'><head><title>[basic.stc.dynamic.safety]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>6</a> Basics <a class='abbr_ref' href='./#basic'>[basic]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>6.7</a> Memory and objects <a class='abbr_ref' href='basic.memobj#basic.stc.dynamic.safety'>[basic.memobj]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>6.7.5</a> Storage duration <a class='abbr_ref' href='basic.stc#dynamic.safety'>[basic.stc]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>6.7.5.5</a> Dynamic storage duration <a class='abbr_ref' href='basic.stc.dynamic#safety'>[basic.stc.dynamic]</a></h4><h4 ><a class='secnum' style='min-width:110pt'>6.7.5.5.4</a> Safely-derived pointers <a class='abbr_ref'>[basic.stc.dynamic.safety]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/basic.tex#L4095'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':pointer,safely-derived'></a><a class='index' id=':pointer,to_traceable_object'></a>A <a class='hidden_link' href='#def:traceable_pointer_object' title='6.7.5.5.4&emsp;Safely-derived pointers&emsp;[basic.stc.dynamic.safety]'><span id='def:traceable_pointer_object'><span class='textit'>traceable pointer object</span></span></a> is
<ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#1.1'>(1.1)</a></div>an object of an <a href='basic.compound#def:object_pointer_type' title='6.8.3&emsp;Compound types&emsp;[basic.compound]'>object pointer type</a>, or</li><li id='1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#1.2'>(1.2)</a></div>an object of an integral type that is at least as large as <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>intptr_&shy;t</span>,
or</li><li id='1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#1.3'>(1.3)</a></div>a sequence of elements in an array of
<a href='basic.fundamental#def:type,narrow_character' title='6.8.2&emsp;Fundamental types&emsp;[basic.fundamental]'>narrow character type</a>, where the size and alignment of the sequence
match those of some object pointer type<a class='hidden_link' href='#1.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/basic.tex#L4108'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>A pointer value is a <a class='hidden_link' href='#def:pointer,safely-derived' title='6.7.5.5.4&emsp;Safely-derived pointers&emsp;[basic.stc.dynamic.safety]'><span id='def:pointer,safely-derived'><span class='textit'>safely-derived pointer</span></span></a> to an object with dynamic storage duration
only if the pointer value has an object pointer type
and is one of the following:
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.1'>(2.1)</a></div>the value returned by a call to the C++ standard library implementation of
<span class='texttt'><span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>&#x200b;size_&shy;t<span class='parenthesis'>)</span></span> or
<span class='texttt'><span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>size_&shy;t, std<span class='operator'>&#x200b;::&#x200b;</span>align_&shy;val_&shy;t<span class='parenthesis'>)</span></span>;<a class='footnotenum' href='#footnote-38' id='footnoteref-38' title='This subclause does not impose restrictions on indirection through pointers to memory not allocated by &#x200b;::&#x200b;operator new. This maintains the ability of many C++ implementations to use binary libraries and components written in other languages. In particular, this applies to C binaries, because indirection through pointers to memory allocated by std&#x200b;::&#x200b;malloc is not restricted.'>38</a></li><li id='2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.2'>(2.2)</a></div>the result of taking the address of an object (or one of its
  subobjects) designated by an lvalue resulting from indirection
  through a safely-derived pointer value;</li><li id='2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.3'>(2.3)</a></div>the result of well-defined pointer arithmetic (<a href='expr.add' title='7.6.6&emsp;Additive operators'>[expr.<span class='shy'></span>add]</a>) using a safely-derived pointer
value;</li><li id='2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.4'>(2.4)</a></div>the result of a well-defined pointer
conversion (<a href='conv.ptr' title='7.3.12&emsp;Pointer conversions'>[conv.<span class='shy'></span>ptr]</a>, <a href='expr.type.conv' title='7.6.1.4&emsp;Explicit type conversion (functional notation)'>[expr.<span class='shy'></span>type.<span class='shy'></span>conv]</a>, <a href='expr.static.cast' title='7.6.1.9&emsp;Static cast'>[expr.<span class='shy'></span>static.<span class='shy'></span>cast]</a>,
<a href='expr.cast' title='7.6.3&emsp;Explicit type conversion (cast notation)'>[expr.<span class='shy'></span>cast]</a>) of a safely-derived pointer value;</li><li id='2.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.5'>(2.5)</a></div>the result of a <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span></span> of a safely-derived pointer value;</li><li id='2.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.6'>(2.6)</a></div>the result of a <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span></span> of an integer representation of a
safely-derived pointer value;</li><li id='2.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.7'>(2.7)</a></div>the value of an object whose value was copied from a traceable pointer object,
where at the time of the copy the source object contained a copy of a safely-derived
pointer value<a class='hidden_link' href='#2.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/basic.tex#L4143'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'><a class='index' id=':integer_representation'></a><a class='index' id=':pointer,integer_representation_of_safely-derived'></a>An integer value is an <a class='hidden_link' href='#def:safely-derived_pointer,integer_representation' title='6.7.5.5.4&emsp;Safely-derived pointers&emsp;[basic.stc.dynamic.safety]'><span id='def:safely-derived_pointer,integer_representation'><span class='textit'>integer representation of a safely-derived pointer</span></span></a>
only if its type is at least as large as <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>intptr_&shy;t</span> and it is one of the
following:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.1'>(3.1)</a></div>the result of a <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span></span> of a safely-derived pointer value;</li><li id='3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.2'>(3.2)</a></div>the result of a valid conversion of an integer representation of a safely-derived
pointer value;</li><li id='3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.3'>(3.3)</a></div>the value of an object whose value was copied from a traceable pointer object,
where at the time of the copy the source object contained an integer representation of a
safely-derived pointer value;</li><li id='3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.4'>(3.4)</a></div>the result of an additive or bitwise operation, one of whose operands is an
integer representation of a safely-derived pointer value <span class='texttt'>P</span>, if that result
converted by <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='operator'>*</span><span class='anglebracket'>&gt;</span></span> would compare equal to a safely-derived
pointer computable from <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='operator'>*</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>P<span class='parenthesis'>)</span></span><a class='hidden_link' href='#3.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/basic.tex#L4165'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>An implementation may have <a class='hidden_link' href='#def:relaxed_pointer_safety' title='6.7.5.5.4&emsp;Safely-derived pointers&emsp;[basic.stc.dynamic.safety]'><span id='def:relaxed_pointer_safety'><span class='textit'>relaxed pointer safety</span></span></a>, in which case the
validity of a pointer value does not depend on whether it is a safely-derived
pointer value<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>Alternatively, an implementation may have <a class='hidden_link' href='#def:strict_pointer_safety' title='6.7.5.5.4&emsp;Safely-derived pointers&emsp;[basic.stc.dynamic.safety]'><span id='def:strict_pointer_safety'><span class='textit'>strict pointer
safety</span></span></a>, in which case a pointer value referring to an object with dynamic
storage duration that is not a safely-derived pointer
value is an invalid pointer value unless
the referenced complete object has previously been declared
reachable (<a href='util.dynamic.safety' title='20.10.5&emsp;Pointer safety'>[util.<span class='shy'></span>dynamic.<span class='shy'></span>safety]</a>)<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<a class='note_link' href='#note-1'><span class='textit'>Note&nbsp;1</span></a><span class='textit'>:</span> <div id='4.sentence-3' class='sentence'>The effect of using an invalid pointer value (including passing it to a
deallocation function) is undefined, see <a href='basic.stc' title='6.7.5&emsp;Storage duration'>[basic.<span class='shy'></span>stc]</a><a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'>This is true even if the unsafely-derived pointer value might compare equal to
some safely-derived pointer value<a class='hidden_link' href='#4.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='4.sentence-5' class='sentence'>
It is
<a class='index' id=':whether_an_implementation_has_relaxed_or_strict_pointer_safety'></a>implementation-defined whether an implementation has relaxed or strict pointer safety<a class='hidden_link' href='#4.sentence-5'>.</a></div> </div></div><div class='footnote' id='footnote-38'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-38'>38)</a></div><div class='texpara'><div id='footnote-38.sentence-1' class='sentence'>This subclause does not impose restrictions
on indirection through pointers to memory not allocated by <span class='texttt'><span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>new</span></span><a class='hidden_link' href='#footnote-38.sentence-1'>.</a></div> <div id='footnote-38.sentence-2' class='sentence'>This
maintains the ability of many C++ implementations to use binary libraries and
components written in other languages<a class='hidden_link' href='#footnote-38.sentence-2'>.</a></div> <div id='footnote-38.sentence-3' class='sentence'>In particular, this applies to C binaries,
because indirection through pointers to memory allocated by <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>malloc</span> is not restricted<a class='hidden_link' href='#footnote-38.sentence-3'>.</a></div>&nbsp;<a href='#footnoteref-38'>⮥</a></div></div></div></body></html>