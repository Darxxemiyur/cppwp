<!DOCTYPE html><html lang='en'><head><title>[expr.await]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>7</a> Expressions <a class='abbr_ref' href='./#expr'>[expr]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>7.6</a> Compound expressions <a class='abbr_ref' href='expr.compound#expr.await'>[expr.compound]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>7.6.2</a> Unary expressions <a class='abbr_ref' href='expr.unary#expr.await'>[expr.unary]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>7.6.2.4</a> Await <a class='abbr_ref'>[expr.await]</a></h4><div class='texpara'><a class='index' id=':expression,await'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4337'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>The <span id=':co_await'><span class='texttt'><span class='keyword'>co_&shy;await</span></span></span> expression is used to suspend evaluation of a
coroutine (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>) while awaiting completion of
the computation represented by the operand expression<a class='hidden_link' href='#1.sentence-1'>.</a></div></div><div class='texpara'><div class='bnf' id='nt:await-expression'>
<a class='hidden_link' href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='nt:await-expression'><span id=':await-expression'>await-expression<span class='textnormal'>:</span></span></span></a><br/><span id=':co_await_'><span class='texttt'><span class='keyword'>co_&shy;await</span></span></span> <a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression'><span class='textsf'><span class='textit'>cast-expression</span></span></span></a>
</div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4347'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> shall appear only in a potentially-evaluated
expression within the <a href='stmt.block#nt:compound-statement' title='8.4&emsp;Compound statement or block&emsp;[stmt.block]'><span id='ntref:compound-statement'><span class='textsf'><span class='textit'>compound-statement</span></span></span></a> of a
<a href='dcl.fct.def.general#nt:function-body' title='9.5.1&emsp;In general&emsp;[dcl.fct.def.general]'><span id='ntref:function-body'><span class='textsf'><span class='textit'>function-body</span></span></span></a> outside of a <a href='except.pre#nt:handler' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:handler'><span class='textsf'><span class='textit'>handler</span></span></span></a> (<a href='except.pre' title='14.1&emsp;Preamble'>[except.<span class='shy'></span>pre]</a>)<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>In a <a href='stmt.dcl#nt:declaration-statement' title='8.8&emsp;Declaration statement&emsp;[stmt.dcl]'><span id='ntref:declaration-statement'><span class='textsf'><span class='textit'>declaration-statement</span></span></span></a> or in the
<a href='dcl.pre#nt:simple-declaration' title='9.1&emsp;Preamble&emsp;[dcl.pre]'><span id='ntref:simple-declaration'><span class='textsf'><span class='textit'>simple-declaration</span></span></span></a> (if any)
of an <a href='stmt.pre#nt:init-statement' title='8.1&emsp;Preamble&emsp;[stmt.pre]'><span id='ntref:init-statement'><span class='textsf'><span class='textit'>init-statement</span></span></span></a>, an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_'><span class='textsf'><span class='textit'>await-expression</span></span></span></a>
shall appear only in an <a href='dcl.init.general#nt:initializer' title='9.4.1&emsp;General&emsp;[dcl.init.general]'><span id='ntref:initializer'><span class='textsf'><span class='textit'>initializer</span></span></span></a> of that
<a href='stmt.dcl#nt:declaration-statement' title='8.8&emsp;Declaration statement&emsp;[stmt.dcl]'><span id='ntref:declaration-statement_'><span class='textsf'><span class='textit'>declaration-statement</span></span></span></a> or <a href='dcl.pre#nt:simple-declaration' title='9.1&emsp;Preamble&emsp;[dcl.pre]'><span id='ntref:simple-declaration_'><span class='textsf'><span class='textit'>simple-declaration</span></span></span></a><a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression__'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> shall not appear in a
default argument (<a href='dcl.fct.default' title='9.3.4.7&emsp;Default arguments'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>default]</a>)<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression___'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> shall not appear in the initializer of
a block-scope variable with static or thread storage duration<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>A context within a function where an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression____'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> can appear
is called a <a class='hidden_link' href='#def:suspension_context' id='def:suspension_context'><i>suspension context</i></a> of the function<a class='hidden_link' href='#2.sentence-5'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4363'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Evaluation of an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_____'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> involves the following
auxiliary types, expressions, and objects:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.1'>(3.1)</a></div><div class='texpara'><div id='3.1.sentence-1' class='sentence'><span class='textit'>p</span> is an lvalue naming the promise
object (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)
of the enclosing coroutine and <span class='texttt'>P</span> is the type of that object<a class='hidden_link' href='#3.1.sentence-1'>.</a></div></div></li><li id='3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.2'>(3.2)</a></div><div class='texpara'><div id='3.2.sentence-1' class='sentence'><span class='textit'>a</span> is the <a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression_'><span class='textsf'><span class='textit'>cast-expression</span></span></span></a> if
the <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression______'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> was implicitly produced by a
<a href='expr.yield#nt:yield-expression' title='7.6.17&emsp;Yielding a value&emsp;[expr.yield]'><span id='ntref:yield-expression'><span class='textsf'><span class='textit'>yield-expression</span></span></span></a> (<a href='expr.yield' title='7.6.17&emsp;Yielding a value'>[expr.<span class='shy'></span>yield]</a>), an initial suspend point,
or a final suspend point (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)<a class='hidden_link' href='#3.2.sentence-1'>.</a></div> <div id='3.2.sentence-2' class='sentence'>Otherwise, the <a href='expr.prim.id.unqual#nt:unqualified-id' title='7.5.4.2&emsp;Unqualified names&emsp;[expr.prim.id.unqual]'><span id='ntref:unqualified-id'><span class='textsf'><span class='textit'>unqualified-id</span></span></span></a> <span class='texttt'>await_&shy;transform</span> is
looked up within the scope of <span class='texttt'>P</span> by class member access
lookup (<a href='basic.lookup.classref' title='6.5.6&emsp;Class member access'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>classref]</a>),
and if this lookup finds at least one declaration, then <span class='textit'>a</span> is
<span class='mbox'><span class='textit'>p</span><span class='texttt'><span class='operator'>.</span>await_&shy;transform<span class='parenthesis'>(</span></span><a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression__'><span class='textsf'><span class='textit'>cast-expression</span></span></span></a><span class='texttt'><span class='parenthesis'>)</span></span></span>;
otherwise, <span class='textit'>a</span> is the  <a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression___'><span class='textsf'><span class='textit'>cast-expression</span></span></span></a><a class='hidden_link' href='#3.2.sentence-2'>.</a></div></div></li><li id='3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.3'>(3.3)</a></div><div class='texpara'><div id='3.3.sentence-1' class='sentence'><span class='textit'>o</span> is determined by enumerating the applicable
<span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>co_&shy;await</span></span> functions for an argument
<span class='textit'>a</span> (<a href='over.match.oper' title='12.4.2.3&emsp;Operators in expressions'>[over.<span class='shy'></span>match.<span class='shy'></span>oper]</a>), and choosing the best one through
overload resolution (<a href='over.match' title='12.4&emsp;Overload resolution'>[over.<span class='shy'></span>match]</a>)<a class='hidden_link' href='#3.3.sentence-1'>.</a></div> <div id='3.3.sentence-2' class='sentence'>If overload resolution is ambiguous,
the program is ill-formed<a class='hidden_link' href='#3.3.sentence-2'>.</a></div> <div id='3.3.sentence-3' class='sentence'>If no viable functions are found, <span class='textit'>o</span> is <span class='textit'>a</span><a class='hidden_link' href='#3.3.sentence-3'>.</a></div> <div id='3.3.sentence-4' class='sentence'>Otherwise, <span class='textit'>o</span> is a call to the selected function
with the argument <span class='textit'>a</span><a class='hidden_link' href='#3.3.sentence-4'>.</a></div> <div id='3.3.sentence-5' class='sentence'>If <span class='textit'>o</span> would be a prvalue,
the temporary materialization conversion (<a href='conv.rval' title='7.3.5&emsp;Temporary materialization conversion'>[conv.<span class='shy'></span>rval]</a>) is applied<a class='hidden_link' href='#3.3.sentence-5'>.</a></div></div></li><li id='3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.4'>(3.4)</a></div><div class='texpara'><div id='3.4.sentence-1' class='sentence'><span class='textit'>e</span> is an lvalue
referring to the result of evaluating
the (possibly-converted) <span class='textit'>o</span><a class='hidden_link' href='#3.4.sentence-1'>.</a></div></div></li><li id='3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.5'>(3.5)</a></div><div class='texpara'><div id='3.5.sentence-1' class='sentence'><span class='textit'>h</span> is an object of type
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_&shy;handle<span class='anglebracket'>&lt;</span>P<span class='anglebracket'>&gt;</span></span>
referring to the enclosing coroutine<a class='hidden_link' href='#3.5.sentence-1'>.</a></div></div></li><li id='3.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.6'>(3.6)</a></div><div class='texpara'><div id='3.6.sentence-1' class='sentence'><span class='textit'>await-ready</span> is the expression
<span class='textit'>e</span><span class='texttt'><span class='operator'>.</span>await_&shy;ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,
contextually converted to <span class='texttt'><span class='keyword'>bool</span></span><a class='hidden_link' href='#3.6.sentence-1'>.</a></div></div></li><li id='3.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.7'>(3.7)</a></div><div class='texpara'><div id='3.7.sentence-1' class='sentence'><span class='textit'>await-suspend</span> is the expression
<span class='textit'>e</span><span class='texttt'><span class='operator'>.</span>await_&shy;suspend<span class='parenthesis'>(</span></span><span class='textit'>h</span><span class='texttt'><span class='parenthesis'>)</span></span>,
which shall be a prvalue of type <span class='texttt'><span class='keyword'>void</span></span>, <span class='texttt'><span class='keyword'>bool</span></span>, or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_&shy;handle<span class='anglebracket'>&lt;</span>Z<span class='anglebracket'>&gt;</span></span> for some type <span class='texttt'>Z</span><a class='hidden_link' href='#3.7.sentence-1'>.</a></div></div></li><li id='3.8'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.8'>(3.8)</a></div><div class='texpara'><div id='3.8.sentence-1' class='sentence'><span class='textit'>await-resume</span> is the expression
<span class='textit'>e</span><span class='texttt'><span class='operator'>.</span>await_&shy;resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#3.8.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4425'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>The <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_______'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> has the same type and value category
as the <span class='textit'>await-resume</span> expression<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4429'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>The <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression________'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> evaluates
the (possibly-converted) <span class='textit'>o</span> expression and
the <span class='textit'>await-ready</span> expression, then:
<ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#5.1'>(5.1)</a></div><div class='texpara'><div id='5.1.sentence-1' class='sentence'>If the result of <span class='textit'>await-ready</span> is <span class='texttt'><span class='literal'>false</span></span>,
the coroutine is considered suspended<a class='hidden_link' href='#5.1.sentence-1'>.</a></div> <div id='5.1.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='5.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.1'>(5.1.1)</a></div><div class='texpara'><div id='5.1.1.sentence-1' class='sentence'>If the type of <span class='textit'>await-suspend</span>
is <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_&shy;handle<span class='anglebracket'>&lt;</span>Z<span class='anglebracket'>&gt;</span></span>,
<span class='textit'>await-suspend</span><span class='texttt'><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is evaluated<a class='hidden_link' href='#5.1.1.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<a class='note_link' href='#note-1'><span class='textit'>Note&nbsp;1</span></a><span class='textit'>:</span> <div id='5.1.1.sentence-2' class='sentence'>This resumes the coroutine referred to
by the result of <span class='textit'>await-suspend</span><a class='hidden_link' href='#5.1.1.sentence-2'>.</a></div> <div id='5.1.1.sentence-3' class='sentence'>Any number of coroutines can be successively resumed in this fashion,
eventually returning control flow to the current coroutine caller or
resumer (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)<a class='hidden_link' href='#5.1.1.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></li><li id='5.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.2'>(5.1.2)</a></div><div class='texpara'><div id='5.1.2.sentence-1' class='sentence'>Otherwise, if the type of <span class='textit'>await-suspend</span>
is <span class='texttt'><span class='keyword'>bool</span></span>,
<span class='textit'>await-suspend</span> is evaluated,
and the coroutine is resumed if the result is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#5.1.2.sentence-1'>.</a></div></div></li><li id='5.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.3'>(5.1.3)</a></div><div class='texpara'><div id='5.1.3.sentence-1' class='sentence'>Otherwise, <span class='textit'>await-suspend</span> is evaluated<a class='hidden_link' href='#5.1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='5.1.sentence-3' class='sentence'>
If the evaluation of <span class='textit'>await-suspend</span>
exits via an exception, the exception is caught,
the coroutine is resumed, and the exception is immediately
re-thrown (<a href='except.throw' title='14.2&emsp;Throwing an exception'>[except.<span class='shy'></span>throw]</a>)<a class='hidden_link' href='#5.1.sentence-3'>.</a></div> <div id='5.1.sentence-4' class='sentence'>Otherwise, control flow returns
to the current coroutine caller or resumer (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)
without exiting any scopes (<a href='stmt.jump' title='8.7&emsp;Jump statements'>[stmt.<span class='shy'></span>jump]</a>)<a class='hidden_link' href='#5.1.sentence-4'>.</a></div></div></li><li id='5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#5.2'>(5.2)</a></div><div class='texpara'><div id='5.2.sentence-1' class='sentence'>If the result of <span class='textit'>await-ready</span> is <span class='texttt'><span class='literal'>true</span></span>,
or when the coroutine is resumed,
the <span class='textit'>await-resume</span> expression is evaluated, and
its result is the result of the <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_________'><span class='textsf'><span class='textit'>await-expression</span></span></span></a><a class='hidden_link' href='#5.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/expressions.tex#L4474'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<a class='example_link' href='#example-1'><span class='textit'>Example&nbsp;1</span></a><span class='textit'>:</span> <span class='codeblock'><span class='keyword'>template</span> <span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> my_future <span class='curlybracket'>{</span>
  <span class='comment'>/* ... */</span>
  <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>std<span class='operator'>::</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
  T await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>template</span> <span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
<span class='keyword'>auto</span> <span class='keyword'>operator</span> <span class='keyword'>co_await</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span> d<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> awaiter <span class='curlybracket'>{</span>
    std<span class='operator'>::</span>chrono<span class='operator'>::</span>system_clock<span class='operator'>::</span>duration duration;
    <span class='comment'>/* ... */</span>
    awaiter<span class='parenthesis'>(</span>std<span class='operator'>::</span>chrono<span class='operator'>::</span>system_clock<span class='operator'>::</span>duration d<span class='parenthesis'>)</span> <span class='operator'>:</span> duration<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> duration<span class='operator'>.</span>count<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>std<span class='operator'>::</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='comment'>/* ... */</span> <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> awaiter<span class='curlybracket'>{</span>d<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>using</span> <span class='keyword'>namespace</span> std<span class='operator'>::</span>chrono;

my_future<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

my_future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> <span class='literal'>"just about go to sleep...\n"</span>;
  <span class='keyword'>co_await</span> <span class='literal'>10ms</span>;
  std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> <span class='literal'>"resumed\n"</span>;
  <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>auto</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span> x <span class='operator'>=</span> <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;   <span class='comment'>// error: <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression__________'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> outside of function suspension context</span>
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>;     <span class='comment'>// error: <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression___________'><span class='textsf'><span class='textit'>await-expression</span></span></span></a> outside of function suspension context</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>