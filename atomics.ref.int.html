<!DOCTYPE html><html lang='en'><head><title>[atomics.ref.int]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>31</a> Atomic operations library <a class='abbr_ref' href='./#atomics'>[atomics]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>31.7</a> Class template <span class='texttt'>atomic_&shy;ref</span> <a class='abbr_ref' href='atomics.ref.generic#atomics.ref.int'>[atomics.ref.generic]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>31.7.3</a> Specializations for integral types <a class='abbr_ref'>[atomics.ref.int]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1120'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id='lib:atomic_ref<integral>'></a>There are specializations of the <span class='texttt'>atomic_&shy;ref</span> class template
for the integral types
<span class='texttt'><span class='keyword'>char</span></span>,
<span class='texttt'><span class='keyword'>signed</span> <span class='keyword'>char</span></span>,
<span class='texttt'><span class='keyword'>unsigned</span> <span class='keyword'>char</span></span>,
<span class='texttt'><span class='keyword'>short</span></span>,
<span class='texttt'><span class='keyword'>unsigned</span> <span class='keyword'>short</span></span>,
<span class='texttt'><span class='keyword'>int</span></span>,
<span class='texttt'><span class='keyword'>unsigned</span> <span class='keyword'>int</span></span>,
<span class='texttt'><span class='keyword'>long</span></span>,
<span class='texttt'><span class='keyword'>unsigned</span> <span class='keyword'>long</span></span>,
<span class='texttt'><span class='keyword'>long</span> <span class='keyword'>long</span></span>,
<span class='texttt'><span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span></span>,
<span class='texttt'><span class='keyword'>char8_&shy;t</span></span>,
<span class='texttt'><span class='keyword'>char16_&shy;t</span></span>,
<span class='texttt'><span class='keyword'>char32_&shy;t</span></span>,
<span class='texttt'><span class='keyword'>wchar_&shy;t</span></span>,
and any other types needed by the typedefs in the header <a href='cstdint.syn#header:%3ccstdint%3e' title='17.4.2&emsp;Header &lt;cstdint&gt; synopsis&emsp;[cstdint.syn]'><span id='headerref:<cstdint>'><span id=':<cstdint>'><span class='texttt'>&lt;cstdint&gt;</span></span></span></a><a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>For each such type <span class='texttt'><span class='textit'>integral</span></span>,
the specialization <span class='texttt'>atomic_&shy;ref<span class='anglebracket'>&lt;</span><span class='textit'>integral</span><span class='anglebracket'>&gt;</span></span> provides
additional atomic operations appropriate to integral types<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<a class='note_link' href='#note-1'><span class='textit'>Note&nbsp;1</span></a><span class='textit'>:</span> <div id='1.sentence-3' class='sentence'>The specialization <span class='texttt'>atomic_&shy;ref<span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span></span>
uses the primary template (<a href='atomics.ref.generic' title='31.7&emsp;Class template atomic_&shy;ref'>[atomics.<span class='shy'></span>ref.<span class='shy'></span>generic]</a>)<a class='hidden_link' href='#1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> atomic_ref<span class='anglebracket'>&lt;</span><span class='textit'>integral</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='textit'>integral</span><span class='operator'>*</span> ptr;        <span class='comment'>// <span class='textit'>exposition only</span></span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> value_type <span class='operator'>=</span> <span class='textit'>integral</span>;
    <span class='keyword'>using</span> difference_type <span class='operator'>=</span> value_type;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> size_t required_alignment <span class='operator'>=</span> <a class='index' id=':required_alignment_for_atomic_ref_type&#39;s_operations'></a><span class='textit'>implementation-defined</span>;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> is_always_lock_free <span class='operator'>=</span> <a class='index' id=':whether_a_given_atomic_ref_type&#39;s_operations_are_always_lock_free'></a><span class='textit'>implementation-defined</span>;
    <span class='keyword'>bool</span> is_lock_free<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>explicit</span> atomic_ref<span class='parenthesis'>(</span><span class='textit'>integral</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span>;
    atomic_ref<span class='parenthesis'>(</span><span class='keyword'>const</span> atomic_ref<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    atomic_ref<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> atomic_ref<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

    <span class='keyword'>void</span> store<span class='parenthesis'>(</span><span class='textit'>integral</span>, memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> load<span class='parenthesis'>(</span>memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>operator</span> <span class='textit'>integral</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='textit'>integral</span> exchange<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                      memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> compare_exchange_weak<span class='parenthesis'>(</span><span class='textit'>integral</span><span class='operator'>&amp;</span>, <span class='textit'>integral</span>,
                               memory_order, memory_order<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> compare_exchange_strong<span class='parenthesis'>(</span><span class='textit'>integral</span><span class='operator'>&amp;</span>, <span class='textit'>integral</span>,
                                 memory_order, memory_order<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> compare_exchange_weak<span class='parenthesis'>(</span><span class='textit'>integral</span><span class='operator'>&amp;</span>, <span class='textit'>integral</span>,
                               memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> compare_exchange_strong<span class='parenthesis'>(</span><span class='textit'>integral</span><span class='operator'>&amp;</span>, <span class='textit'>integral</span>,
                                 memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='textit'>integral</span> fetch_add<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                       memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> fetch_sub<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                       memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> fetch_and<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                       memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> fetch_or<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                      memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> fetch_xor<span class='parenthesis'>(</span><span class='textit'>integral</span>,
                       memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>+</span><span class='operator'>+</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>-</span><span class='operator'>-</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>+</span><span class='operator'>+</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>-</span><span class='operator'>-</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>+</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>-</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>&amp;</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>|</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='textit'>integral</span> <span class='keyword'>operator</span><span class='operator'>^</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> wait<span class='parenthesis'>(</span><span class='textit'>integral</span>, memory_order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> notify_one<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> notify_all<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1209'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>Descriptions are provided below only for members
that differ from the primary template<a class='hidden_link' href='#2.sentence-1'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1213'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>The following operations perform arithmetic computations<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>The key, operator, and computation correspondence is identified
in Table <a href='atomics.types.int#tab:atomic.types.int.comp' title='Table 144: Atomic arithmetic computations'>144</a><a class='hidden_link' href='#3.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:atomic_ref<integral>,fetch_xor'><div id='lib:fetch_xor,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,fetch_sub'><div id='lib:fetch_sub,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,fetch_or'><div id='lib:fetch_or,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,fetch_and'><div id='lib:fetch_and,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,fetch_add'><div id='lib:fetch_add,atomic_ref<integral>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:fetch_add,atomic_ref%3cintegral%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='textit'>integral</span> fetch_<span class='textit'>key</span><span class='parenthesis'>(</span><span class='textit'>integral</span> operand, memory_order order <span class='operator'>=</span> memory_order<span class='operator'>::</span>seq_cst<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div></div></div></div></div></div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1228'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><span class='textit'>Effects</span>: Atomically replaces the value referenced by <span class='texttt'><span class='operator'>*</span>ptr</span> with
the result of the computation applied to the value referenced by <span class='texttt'><span class='operator'>*</span>ptr</span>
and the given operand<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>Memory is affected according to the value of <span class='texttt'>order</span><a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>These operations are atomic read-modify-write operations (<a href='intro.races' title='6.9.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>)<a class='hidden_link' href='#4.sentence-3'>.</a></div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1236'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'><span class='textit'>Returns</span>: Atomically, the value referenced by <span class='texttt'><span class='operator'>*</span>ptr</span>
immediately before the effects<a class='hidden_link' href='#5.sentence-1'>.</a></div></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1241'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'><a class='index' id=':signed_integer_representation,two&#39;s_complement'></a><span class='textit'>Remarks</span>: For signed integer types,
the result is as if the object value and parameters
were converted to their corresponding unsigned types,
the computation performed on those types, and
the result converted back to the signed type<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='note-2' class='note'><div class='texpara'>[<a class='note_link' href='#note-2'><span class='textit'>Note&nbsp;2</span></a><span class='textit'>:</span> <div id='6.sentence-2' class='sentence'>There are no undefined results arising from the computation<a class='hidden_link' href='#6.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='texpara'><div id='lib:atomic_ref<integral>,operator^='><div id='lib:operator^=,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,operator|='><div id='lib:operator|=,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,operator&amp;='><div id='lib:operator&amp;=,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,operator-='><div id='lib:operator-=,atomic_ref<integral>'><div id='lib:atomic_ref<integral>,operator+='><div id='lib:operator+=,atomic_ref<integral>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator+=,atomic_ref%3cintegral%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='textit'>integral</span> <span class='keyword'>operator</span> <span class='textit'>op</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='textit'>integral</span> operand<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div></div></div></div></div></div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/atomics.tex#L1264'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'><span class='textit'>Effects</span>: Equivalent to:
<span class='texttt'><span class='keyword'>return</span> fetch_&shy;<span class='textit'>key</span><span class='parenthesis'>(</span>operand<span class='parenthesis'>)</span> <span class='textit'>op</span> operand;</span></div></div></div></div></div></body></html>