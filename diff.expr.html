<!DOCTYPE html><html lang='en'><head><title>[diff.expr]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:73pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>C.5</a> C++ and ISO C <a class='abbr_ref' href='diff.iso#diff.expr'>[diff.iso]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>C.5.3</a> <a href='expr'>[expr]</a>: expressions <a class='abbr_ref'>[diff.expr]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/compatibility.tex#L1970'>#</a></div><b>Affected subclause:</b> <a href='conv.ptr'>[conv.ptr]</a>
<br/> <div id='1.sentence-1' class='sentence'><b>Change:</b> 
Converting <span class='texttt'><span class='keyword'>void</span><span class='operator'>*</span></span> to a pointer-to-object type requires casting<a class='hidden_link' href='#1.sentence-1'>.</a></div><pre class='codeblock'>
<span class='keyword'>char</span> a<span class='squarebracket'>[</span><span class='literal'>10</span><span class='squarebracket'>]</span>;
<span class='keyword'>void</span><span class='operator'>*</span> b<span class='operator'>=</span>a;
<span class='keyword'>void</span> foo<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>char</span><span class='operator'>*</span> c<span class='operator'>=</span>b;
<span class='curlybracket'>}</span>
</pre><div id='1.sentence-2' class='sentence'>ISO C will accept this usage of pointer to void being assigned
to a pointer to object type<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>C++ will not<a class='hidden_link' href='#1.sentence-3'>.</a></div> <br/> <div id='1.sentence-4' class='sentence'><b>Rationale:</b> 
C++ tries harder than C to enforce compile-time type safety<a class='hidden_link' href='#1.sentence-4'>.</a></div> <br/> <div id='1.sentence-5' class='sentence'><b>Effect on original feature:</b> 
Deletion of semantically well-defined feature<a class='hidden_link' href='#1.sentence-5'>.</a></div> <br/> <div id='1.sentence-6' class='sentence'><b>Difficulty of converting:</b> 
Could be automated<a class='hidden_link' href='#1.sentence-6'>.</a></div> <div id='1.sentence-7' class='sentence'>Violations will be diagnosed by the C++ translator<a class='hidden_link' href='#1.sentence-7'>.</a></div> <div id='1.sentence-8' class='sentence'>The
fix is to add a  cast<a class='hidden_link' href='#1.sentence-8'>.</a></div> <div id='1.sentence-9' class='sentence'>For example:
<pre class='codeblock'>
<span class='keyword'>char</span><span class='operator'>*</span> c <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span><span class='parenthesis'>)</span> b;
</pre></div><br/> <div id='1.sentence-10' class='sentence'><b>How widely used:</b> 
This is fairly widely used but it is good
programming practice to add the cast when assigning pointer-to-void to pointer-to-object<a class='hidden_link' href='#1.sentence-10'>.</a></div> <div id='1.sentence-11' class='sentence'>Some ISO C translators will give a warning
if the cast is not used<a class='hidden_link' href='#1.sentence-11'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/compatibility.tex#L2005'>#</a></div><b>Affected subclause:</b> <a href='expr.call'>[expr.call]</a>
<br/> <div id='2.sentence-1' class='sentence'><b>Change:</b> 
Implicit declaration of functions is not allowed<a class='hidden_link' href='#2.sentence-1'>.</a></div> <br/> <div id='2.sentence-2' class='sentence'><b>Rationale:</b> 
The type-safe nature of C++<a class='hidden_link' href='#2.sentence-2'>.</a></div> <br/> <div id='2.sentence-3' class='sentence'><b>Effect on original feature:</b> 
Deletion of semantically well-defined feature<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>Note: the original feature was labeled as “obsolescent” in ISO C<a class='hidden_link' href='#2.sentence-4'>.</a><br/></div> <div id='2.sentence-5' class='sentence'><b>Difficulty of converting:</b> 
Syntactic transformation<a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'>Facilities for producing explicit function declarations are fairly
widespread commercially<a class='hidden_link' href='#2.sentence-6'>.</a></div> <br/> <div id='2.sentence-7' class='sentence'><b>How widely used:</b> 
Common<a class='hidden_link' href='#2.sentence-7'>.</a></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/compatibility.tex#L2020'>#</a></div><b>Affected subclauses:</b> <a href='expr.post.incr'>[expr.post.incr]</a> and <a href='expr.pre.incr'>[expr.pre.incr]</a>
<br/> <div id='3.sentence-1' class='sentence'><b>Change:</b> 
Decrement operator is not allowed with <span class='texttt'><span class='keyword'>bool</span></span> operand<a class='hidden_link' href='#3.sentence-1'>.</a></div> <br/> <div id='3.sentence-2' class='sentence'><b>Rationale:</b> 
Feature with surprising semantics<a class='hidden_link' href='#3.sentence-2'>.</a></div> <br/> <div id='3.sentence-3' class='sentence'><b>Effect on original feature:</b> 
A valid ISO C expression utilizing the decrement operator on
a <span class='texttt'><span class='keyword'>bool</span></span> lvalue
(for instance, via the C typedef in <span class='indexparent'><a class='index' id=':<stdbool.h>'></a></span><span class='texttt'><span class='anglebracket'>&lt;</span>stdbool<span class='operator'>.</span>h<span class='anglebracket'>&gt;</span></span> (<a href='depr.stdbool.h.syn'>[depr.stdbool.h.syn]</a>))
is ill-formed in this International Standard<a class='hidden_link' href='#3.sentence-3'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/compatibility.tex#L2031'>#</a></div><b>Affected subclauses:</b> <a href='expr.sizeof'>[expr.sizeof]</a> and <a href='expr.cast'>[expr.cast]</a>
<br/> <div id='4.sentence-1' class='sentence'><b>Change:</b> 
Types must be defined in declarations, not in expressions<a class='hidden_link' href='#4.sentence-1'>.</a></div> <br/> <div id='4.sentence-2' class='sentence'>
In C, a sizeof expression or cast expression may define a new type<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>For example,
<pre class='codeblock'>
p <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>struct</span> x <span class='curlybracket'>{</span><span class='keyword'>int</span> i;<span class='curlybracket'>}</span> <span class='operator'>*</span><span class='parenthesis'>)</span><span class='literal'>0</span>;
</pre>
defines a new type, struct <span class='texttt'>x</span><a class='hidden_link' href='#4.sentence-3'>.</a></div> <br/> <div id='4.sentence-4' class='sentence'><b>Rationale:</b> 
This prohibition helps to clarify the location of
definitions in the source code<a class='hidden_link' href='#4.sentence-4'>.</a></div> <br/> <div id='4.sentence-5' class='sentence'><b>Effect on original feature:</b> 
Deletion of semantically well-defined feature<a class='hidden_link' href='#4.sentence-5'>.</a></div> <br/> <div id='4.sentence-6' class='sentence'><b>Difficulty of converting:</b> 
Syntactic transformation<a class='hidden_link' href='#4.sentence-6'>.</a></div> <br/> <div id='4.sentence-7' class='sentence'><b>How widely used:</b> 
Seldom<a class='hidden_link' href='#4.sentence-7'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/compatibility.tex#L2050'>#</a></div><b>Affected subclauses:</b> <a href='expr.cond'>[expr.cond]</a>, <a href='expr.ass'>[expr.ass]</a>, and <a href='expr.comma'>[expr.comma]</a>
<span class='indexparent'><a class='index' id=':conversion,lvalue-to-rvalue'></a></span><span class='indexparent'><a class='index' id=':rvalue,lvalue_conversion_to'></a></span><span class='indexparent'><a class='index' id=':lvalue'></a></span><br/> <div id='5.sentence-1' class='sentence'><b>Change:</b> 
The result of a conditional expression, an assignment expression, or a comma expression may be an lvalue<a class='hidden_link' href='#5.sentence-1'>.</a></div> <br/> <div id='5.sentence-2' class='sentence'><b>Rationale:</b> 
C++ is an object-oriented language, placing relatively
more emphasis on lvalues<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>For example, function calls may
yield lvalues<a class='hidden_link' href='#5.sentence-3'>.</a></div> <br/> <div id='5.sentence-4' class='sentence'><b>Effect on original feature:</b> 
Change to semantics of well-defined feature<a class='hidden_link' href='#5.sentence-4'>.</a></div> <div id='5.sentence-5' class='sentence'>Some C
expressions that implicitly rely on lvalue-to-rvalue
conversions will yield different results<a class='hidden_link' href='#5.sentence-5'>.</a></div> <div id='5.sentence-6' class='sentence'>For example,</div><pre class='codeblock'>
<span class='keyword'>char</span> arr<span class='squarebracket'>[</span><span class='literal'>100</span><span class='squarebracket'>]</span>;
<span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='literal'>0</span>, arr<span class='parenthesis'>)</span>
</pre><div id='5.sentence-7' class='sentence'>yields
<span class='texttt'><span class='literal'>100</span></span>
in C++ and
<span class='texttt'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span><span class='parenthesis'>)</span></span>
in C<a class='hidden_link' href='#5.sentence-7'>.</a><br/></div> <div id='5.sentence-8' class='sentence'><b>Difficulty of converting:</b> 
Programs must add explicit casts to the appropriate rvalue<a class='hidden_link' href='#5.sentence-8'>.</a></div> <br/> <div id='5.sentence-9' class='sentence'><b>How widely used:</b> 
Rare<a class='hidden_link' href='#5.sentence-9'>.</a></div></div></div></body></html>