<!DOCTYPE html><html lang='en'><head><title>[lex.phases]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>5</a> Lexical conventions <a class='abbr_ref' href='./#lex'>[lex]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>5.2</a> Phases of translation <a class='abbr_ref'>[lex.phases]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3a3350ee86fb2dbc86752af66d56102d237d8c4f/source/lex.tex#L57'>#</a></div><div id='1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':translation,phases'></a></span>The precedence among the syntax rules of translation is specified by the
following phases<a class='hidden_link' href='#1.sentence-1'>.</a><a class='footnotenum' href='#footnote-6' id='footnoteref-6'>6</a></div><ol class='enumerate'><li id='1.1'><a class='enumerated_item_num' href='#1.1'>1.</a><div id='1.1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':character,source_file'></a></span><span class='indexparent'><a class='index' id=':character_set,basic_source'></a></span>Physical source file characters are mapped, in an
<span class='indexparent'><a class='index' id=':mapping_physical_source_file_characters_to_basic_source_character_set'></a></span>implementation-defined manner,
to the basic source character set (introducing new-line characters for end-of-line
indicators) if necessary<a class='hidden_link' href='#1.1.sentence-1'>.</a></div> <div id='1.1.sentence-2' class='sentence'>The set of physical source file characters accepted is <span class='indexparent'><a class='index' id=':physical_source_file_characters'></a></span>implementation-defined<a class='hidden_link' href='#1.1.sentence-2'>.</a></div> <div id='1.1.sentence-3' class='sentence'>Any
source file character not in the
<a href='lex.charset#def:basic_source_character_set'>basic source character set</a> is replaced by the
<span class='indexparent'><a class='index' id=':universal_character_name'></a></span><a class='grammarterm' href='lex.charset#nt:universal-character-name'>universal-character-name</a> that
designates that character<a class='hidden_link' href='#1.1.sentence-3'>.</a></div> <div id='1.1.sentence-4' class='sentence'>An implementation may use any internal
encoding, so long as an actual extended character encountered in the
source file, and the same extended character expressed in the source
file as a <a class='grammarterm' href='lex.charset#nt:universal-character-name'>universal-character-name</a> (e.g., using the <span class='texttt'>\
uXXXX</span> notation), are handled equivalently
except where this replacement is reverted (<a href='lex.pptoken'>[lex.pptoken]</a>) in a raw string literal<a class='hidden_link' href='#1.1.sentence-4'>.</a></div></li><li id='1.2'><a class='enumerated_item_num' href='#1.2'>2.</a><div id='1.2.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':line_splicing'></a></span>Each instance of a backslash character (\)
immediately followed by a new-line character is deleted, splicing
physical source lines to form logical source lines<a class='hidden_link' href='#1.2.sentence-1'>.</a></div> <div id='1.2.sentence-2' class='sentence'>Only the last
backslash on any physical source line shall be eligible for being part
of such a splice<a class='hidden_link' href='#1.2.sentence-2'>.</a></div> <div id='1.2.sentence-3' class='sentence'>Except for splices reverted in a raw string literal, if a splice results in
a character sequence that matches the
syntax of a <a class='grammarterm' href='lex.charset#nt:universal-character-name'>universal-character-name</a>, the behavior is
undefined<a class='hidden_link' href='#1.2.sentence-3'>.</a></div> <div id='1.2.sentence-4' class='sentence'>A source file that is not empty and that does not end in a new-line
character, or that ends in a new-line character immediately preceded by a
backslash character before any such splicing takes place,
shall be processed as if an additional new-line character were appended
to the file<a class='hidden_link' href='#1.2.sentence-4'>.</a></div></li><li id='1.3'><a class='enumerated_item_num' href='#1.3'>3.</a><div id='1.3.sentence-1' class='sentence'>The source file is decomposed into <a href='lex.pptoken'>preprocessing
tokens</a> and sequences of white-space characters
(including comments)<a class='hidden_link' href='#1.3.sentence-1'>.</a></div> <div id='1.3.sentence-2' class='sentence'>A source file shall not end in a partial
preprocessing token or in a partial comment<a class='hidden_link' href='#1.3.sentence-2'>.</a><a class='footnotenum' href='#footnote-7' id='footnoteref-7'>7</a></div> <div id='1.3.sentence-3' class='sentence'>
Each comment is replaced by one space character<a class='hidden_link' href='#1.3.sentence-3'>.</a></div> <div id='1.3.sentence-4' class='sentence'>New-line characters are
retained<a class='hidden_link' href='#1.3.sentence-4'>.</a></div> <div id='1.3.sentence-5' class='sentence'>Whether each nonempty sequence of white-space characters other
than new-line is retained or replaced by one space character is
unspecified<a class='hidden_link' href='#1.3.sentence-5'>.</a></div> <div id='1.3.sentence-6' class='sentence'>The process of dividing a source file's
characters into preprocessing tokens is context-dependent<a class='hidden_link' href='#1.3.sentence-6'>.</a></div> <div id='1.3.example-1' class='example'>[&nbsp;<a class='example_link' href='#1.3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='1.3.sentence-7' class='sentence'>See the handling of <span class='texttt'><span class='anglebracket'>&lt;</span></span> within a <span class='texttt'><span class='preprocessordirective'>#include</span></span> preprocessing
directive<a class='hidden_link' href='#1.3.sentence-7'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </li><li id='1.4'><a class='enumerated_item_num' href='#1.4'>4.</a><div id='1.4.sentence-1' class='sentence'>Preprocessing directives are executed, macro invocations are
expanded, and <span class='texttt'><span class='preprocessordirective'>_&shy;Pragma</span></span> unary operator expressions are executed<a class='hidden_link' href='#1.4.sentence-1'>.</a></div> <div id='1.4.sentence-2' class='sentence'>If a character sequence that matches the syntax of a
<a class='grammarterm' href='lex.charset#nt:universal-character-name'>universal-character-name</a> is produced by <a href='cpp.concat'>token
concatenation</a>, the behavior is undefined<a class='hidden_link' href='#1.4.sentence-2'>.</a></div> <div id='1.4.sentence-3' class='sentence'>A
<span class='texttt'><span class='preprocessordirective'>#include</span></span> preprocessing directive causes the named header or
source file to be processed from phase 1 through phase 4, recursively<a class='hidden_link' href='#1.4.sentence-3'>.</a></div> <div id='1.4.sentence-4' class='sentence'>All preprocessing directives are then deleted<a class='hidden_link' href='#1.4.sentence-4'>.</a></div></li><li id='1.5'><a class='enumerated_item_num' href='#1.5'>5.</a><div id='1.5.sentence-1' class='sentence'>Each basic source character set member in a <a class='grammarterm' href='lex.ccon#nt:character-literal'>character-literal</a> or a
<a class='grammarterm' href='lex.string#nt:string-literal'>string-literal</a>, as well as each escape sequence and <a class='grammarterm' href='lex.charset#nt:universal-character-name'>universal-character-name</a> in a
<a class='grammarterm' href='lex.ccon#nt:character-literal'>character-literal</a> or a non-raw string literal, is converted to the corresponding
member of the execution character set (<a href='lex.ccon'>[lex.ccon]</a>, <a href='lex.string'>[lex.string]</a>); if
there is no corresponding member, it is converted to an <span class='indexparent'><a class='index' id=':converting_characters_from_source_character_set_to_execution_character_set'></a></span>implementation-defined member other
than the null (wide) character<a class='hidden_link' href='#1.5.sentence-1'>.</a><a class='footnotenum' href='#footnote-8' id='footnoteref-8'>8</a></div></li><li id='1.6'><a class='enumerated_item_num' href='#1.6'>6.</a><div id='1.6.sentence-1' class='sentence'>Adjacent string literal tokens are concatenated<a class='hidden_link' href='#1.6.sentence-1'>.</a></div></li><li id='1.7'><a class='enumerated_item_num' href='#1.7'>7.</a><div id='1.7.sentence-1' class='sentence'>White-space characters separating tokens are no longer
significant<a class='hidden_link' href='#1.7.sentence-1'>.</a></div> <div id='1.7.sentence-2' class='sentence'>Each preprocessing token is converted into a
token (<a href='lex.token'>[lex.token]</a>)<a class='hidden_link' href='#1.7.sentence-2'>.</a></div> <div id='1.7.sentence-3' class='sentence'>The resulting tokens are syntactically and
semantically analyzed and translated as a translation unit<a class='hidden_link' href='#1.7.sentence-3'>.</a></div> <div id='1.7.note-1' class='note'>[&nbsp;<a class='note_link' href='#1.7.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.7.sentence-4' class='sentence'>The process of analyzing and translating the tokens may occasionally
result in one token being replaced by a sequence of other
tokens (<a href='temp.names'>[temp.names]</a>)<a class='hidden_link' href='#1.7.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='1.7.sentence-5' class='sentence'>
It is
<span class='indexparent'><a class='index' id=':whether_the_sources_for_module_units_and_header_units_on_which_the_current_translation_unit_has_an_interface_dependency_are_required_to_be_available_during_translation'></a></span>implementation-defined
whether the sources for
module units and header units
on which the current translation unit has an interface
dependency (<a href='module.unit'>[module.unit]</a>, <a href='module.import'>[module.import]</a>)
are required to be available<a class='hidden_link' href='#1.7.sentence-5'>.</a></div> <div id='1.7.note-2' class='note'>[&nbsp;<a class='note_link' href='#1.7.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.7.sentence-6' class='sentence'>Source files, translation
units and translated translation units need not necessarily be stored as
files, nor need there be any one-to-one correspondence between these
entities and any external representation<a class='hidden_link' href='#1.7.sentence-6'>.</a></div> <div id='1.7.sentence-7' class='sentence'>The description is conceptual
only, and does not specify any particular implementation<a class='hidden_link' href='#1.7.sentence-7'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </li><li id='1.8'><a class='enumerated_item_num' href='#1.8'>8.</a><div id='1.8.sentence-2' class='sentence'>Translated translation units and instantiation units are combined
as follows:
<div id='1.8.note-3' class='note'>[&nbsp;<a class='note_link' href='#1.8.note-3'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> Some or all of these may be supplied from a
library. —&nbsp;<i>end note</i></div>&nbsp;]</div> 
Each translated translation unit is examined to
produce a list of required instantiations<a class='hidden_link' href='#1.8.sentence-2'>.</a></div> <div id='1.8.note-4' class='note'>[&nbsp;<a class='note_link' href='#1.8.note-4'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.8.sentence-3' class='sentence'>This may include
instantiations which have been explicitly
requested (<a href='temp.explicit'>[temp.explicit]</a>)<a class='hidden_link' href='#1.8.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='1.8.sentence-4' class='sentence'>
The definitions of the
required templates are located<a class='hidden_link' href='#1.8.sentence-4'>.</a></div> <div id='1.8.sentence-5' class='sentence'>It is <span class='indexparent'><a class='index' id=':whether_source_of_translation_units_must_be_available_to_locate_template_definitions'></a></span>implementation-defined whether the
source of the translation units containing these definitions is required
to be available<a class='hidden_link' href='#1.8.sentence-5'>.</a></div> <div id='1.8.note-5' class='note'>[&nbsp;<a class='note_link' href='#1.8.note-5'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.8.sentence-6' class='sentence'>An implementation could encode sufficient
information into the translated translation unit so as to ensure the
source is not required here<a class='hidden_link' href='#1.8.sentence-6'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='1.8.sentence-7' class='sentence'>
All the required instantiations
are performed to produce
<a class='hidden_link' href='#def:instantiation_units' id='def:instantiation_units'><i >instantiation units</i></a><a class='hidden_link' href='#1.8.sentence-7'>.</a></div> <div id='1.8.note-6' class='note'>[&nbsp;<a class='note_link' href='#1.8.note-6'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.8.sentence-8' class='sentence'>These are similar
to translated translation units, but contain no references to
uninstantiated templates and no template definitions<a class='hidden_link' href='#1.8.sentence-8'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='1.8.sentence-9' class='sentence'>
The
program is ill-formed if any instantiation fails<a class='hidden_link' href='#1.8.sentence-9'>.</a></div></li><li id='1.9'><a class='enumerated_item_num' href='#1.9'>9.</a><div id='1.9.sentence-1' class='sentence'>All external entity references are resolved<a class='hidden_link' href='#1.9.sentence-1'>.</a></div> <div id='1.9.sentence-2' class='sentence'>Library
components are linked to satisfy external references to
entities not defined in the current translation<a class='hidden_link' href='#1.9.sentence-2'>.</a></div> <div id='1.9.sentence-3' class='sentence'>All such translator
output is collected into a program image which contains information
needed for execution in its execution environment<a class='hidden_link' href='#1.9.sentence-3'>.</a></div> </li></ol></div><div class='footnote' id='footnote-6'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-6'>6)</a></div><div id='footnote-6.sentence-1' class='sentence'>Implementations must behave as if these separate phases
occur, although in practice different phases might be folded together<a class='hidden_link' href='#footnote-6.sentence-1'>.</a></div> <a href='#footnoteref-6'>⮥</a></div><div class='footnote' id='footnote-7'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-7'>7)</a></div><div id='footnote-7.sentence-1' class='sentence'>A partial preprocessing
token would arise from a source file
ending in the first portion of a multi-character token that requires a
terminating sequence of characters, such as a <a class='grammarterm' href='lex.header#nt:header-name'>header-name</a>
that is missing the closing <span class='texttt'>"</span>
or <span class='texttt'><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#footnote-7.sentence-1'>.</a></div> <div id='footnote-7.sentence-2' class='sentence'>A partial comment
would arise from a source file ending with an unclosed <span class='texttt'><span class='comment'>/*</span></span>
comment<a class='hidden_link' href='#footnote-7.sentence-2'>.</a></div> <a href='#footnoteref-7'>⮥</a></div><div class='footnote' id='footnote-8'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-8'>8)</a></div><div id='footnote-8.sentence-1' class='sentence'>An implementation need not convert all
non-corresponding source characters to the same execution character<a class='hidden_link' href='#footnote-8.sentence-1'>.</a></div> <a href='#footnoteref-8'>⮥</a></div></div></body></html>