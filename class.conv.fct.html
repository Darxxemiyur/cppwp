<!DOCTYPE html><html lang='en'><head><title>[class.conv.fct]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>11</a> Classes <a class='abbr_ref' href='./#class'>[class]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>11.4</a> Class members <a class='abbr_ref' href='class.mem#class.conv.fct'>[class.mem]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>11.4.7</a> Conversions <a class='abbr_ref' href='class.conv#fct'>[class.conv]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>11.4.7.2</a> Conversion functions <a class='abbr_ref'>[class.conv.fct]</a></h4><span class='indexparent'><a class='index' id=':function,conversion'></a></span><span class='indexparent'><a class='index' id=':conversion,user-defined'></a></span><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2604'>#</a></div><div id='1.sentence-1' class='sentence'>A member function of a class <span class='texttt'>X</span> having no parameters with a name of the form
<pre class='bnf'><a class='nontermdef' href='#nt:conversion-function-id' id='nt:conversion-function-id'>conversion-function-id</a><span class='ntdefcolon'>:</span>
&#9;<span class='texttt'><span class='keyword'>operator</span></span><span class='indexparent'><a class='index' id=':operator'></a></span> <a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a>
</pre></div><pre class='bnf'><a class='nontermdef' href='#nt:conversion-type-id' id='nt:conversion-type-id'>conversion-type-id</a><span class='ntdefcolon'>:</span>
&#9;<a class='grammarterm' href='dcl.type#nt:type-specifier-seq'>type-specifier-seq</a> <a class='grammarterm' href='#nt:conversion-declarator'>conversion-declarator</a><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>
</pre><div id='1.sentence-2' class='sentence'><pre class='bnf'><a class='nontermdef' href='#nt:conversion-declarator' id='nt:conversion-declarator'>conversion-declarator</a><span class='ntdefcolon'>:</span>
&#9;<a class='grammarterm' href='dcl.decl#nt:ptr-operator'>ptr-operator</a> <a class='grammarterm' href='#nt:conversion-declarator'>conversion-declarator</a><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>
</pre>
specifies a conversion from
<span class='texttt'>X</span>
to the type specified by the
<a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>Such functions are called <a class='hidden_link' href='#def:conversion_function' id='def:conversion_function'><i >conversion functions</i></a><a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>A <a class='grammarterm' href='dcl.spec#nt:decl-specifier'>decl-specifier</a> in the <a class='grammarterm' href='dcl.spec#nt:decl-specifier-seq'>decl-specifier-seq</a>
of a conversion function (if any) shall be neither
a <a class='grammarterm' href='dcl.type#nt:defining-type-specifier'>defining-type-specifier</a> nor <span class='texttt'><span class='keyword'>static</span></span><a class='hidden_link' href='#1.sentence-4'>.</a></div> <div id='1.sentence-5' class='sentence'><span class='indexparent'><a class='index' id=':conversion,type_of'></a></span>The type of the conversion function (<a href='dcl.fct'>[dcl.fct]</a>) is
“function taking no parameter returning
<a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a>”<a class='hidden_link' href='#1.sentence-5'>.</a></div> <div id='1.sentence-6' class='sentence'>A conversion function is never used to convert a (possibly cv-qualified) object
to the (possibly cv-qualified) same object type (or a reference to it),
to a (possibly cv-qualified) base class of that type (or a reference to it),
or to <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span></span><a class='hidden_link' href='#1.sentence-6'>.</a><a class='footnotenum' href='#footnote-106' id='footnoteref-106'>106</a></div> <div id='1.example-1' class='example'>[&nbsp;<a class='example_link' href='#1.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> X <span class='curlybracket'>{</span>
  <span class='keyword'>operator</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>operator</span> <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>short</span>;     <span class='comment'>// error: trailing return type</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> f<span class='parenthesis'>(</span>X a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i <span class='operator'>=</span> <span class='keyword'>int</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>;
  i <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>a;
  i <span class='operator'>=</span> a;
<span class='curlybracket'>}</span>
</pre> <div id='1.sentence-7' class='sentence'>
In all three cases the value assigned will be converted by
<span class='texttt'>X<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#1.sentence-7'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2657'>#</a></div><div id='2.sentence-1' class='sentence'>A conversion function may be explicit (<a href='dcl.fct.spec'>[dcl.fct.spec]</a>), in which case it is only considered as a user-defined conversion for direct-initialization (<a href='dcl.init'>[dcl.init]</a>)<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>Otherwise, user-defined conversions are not restricted to use in assignments and initializations<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.example-1' class='example'>[&nbsp;<a class='example_link' href='#2.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>class</span> Y <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> Z <span class='curlybracket'>{</span>
  <span class='keyword'>explicit</span> <span class='keyword'>operator</span> Y<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> h<span class='parenthesis'>(</span>Z z<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  Y y1<span class='parenthesis'>(</span>z<span class='parenthesis'>)</span>;          <span class='comment'>// OK: direct-initialization</span>
  Y y2 <span class='operator'>=</span> z;         <span class='comment'>// error: no conversion function candidate for copy-initialization</span>
  Y y3 <span class='operator'>=</span> <span class='parenthesis'>(</span>Y<span class='parenthesis'>)</span>z;      <span class='comment'>// OK: cast notation</span>
<span class='curlybracket'>}</span>

<span class='keyword'>void</span> g<span class='parenthesis'>(</span>X a, X b<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i <span class='operator'>=</span> <span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>1</span><span class='operator'>+</span>a <span class='operator'>:</span> <span class='literal'>0</span>;
  <span class='keyword'>int</span> j <span class='operator'>=</span> <span class='parenthesis'>(</span>a<span class='operator'>&amp;</span><span class='operator'>&amp;</span>b<span class='parenthesis'>)</span> <span class='operator'>?</span> a<span class='operator'>+</span>b <span class='operator'>:</span> i;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2681'>#</a></div><div id='3.sentence-1' class='sentence'>The
<a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a>
shall not represent a function type nor an array type<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>The
<a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a>
in a
<a class='grammarterm' href='#nt:conversion-function-id'>conversion-function-id</a>
is the longest sequence of
tokens that could possibly form a <a class='grammarterm' href='#nt:conversion-type-id'>conversion-type-id</a><a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.note-1' class='note'>[&nbsp;<a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-3' class='sentence'>This prevents ambiguities between the declarator operator <span class='texttt'><span class='operator'>*</span></span> and its expression
counterparts<a class='hidden_link' href='#3.sentence-3'>.</a></div> <div id='3.example-1' class='example'>[&nbsp;<a class='example_link' href='#3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='operator'>&amp;</span>ac<span class='operator'>.</span><span class='keyword'>operator</span> <span class='keyword'>int</span><span class='operator'>*</span>i; <span class='comment'>// syntax error:</span>
                    <span class='comment'>// parsed as: <span class='tcode_in_codeblock'>&amp;(ac.operator int *)i</span></span>
                    <span class='comment'>// not as: <span class='tcode_in_codeblock'>&amp;(ac.operator int)*i</span></span>
</pre> <div id='3.sentence-4' class='sentence'>
The <span class='texttt'><span class='operator'>*</span></span> is the pointer declarator and not the multiplication operator<a class='hidden_link' href='#3.sentence-4'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  <div id='3.sentence-5' class='sentence'>
This rule also prevents ambiguities for attributes<a class='hidden_link' href='#3.sentence-5'>.</a></div> <div id='3.example-2' class='example'>[&nbsp;<a class='example_link' href='#3.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>operator</span> <span class='keyword'>int</span> <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='parenthesis'>(</span><span class='parenthesis'>)</span>;   <span class='comment'>// error: <span class='tcode_in_codeblock'>noreturn</span> attribute applied to a type</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2710'>#</a></div><div id='4.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':conversion,inheritance_of_user-defined'></a></span>Conversion functions are inherited<a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2714'>#</a></div><div id='5.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':conversion,virtual_user-defined'></a></span>Conversion functions can be virtual<a class='hidden_link' href='#5.sentence-1'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/0869f240e1b791a7c040d64ea44c435bfb67a237/source/classes.tex#L2718'>#</a></div><div id='6.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':conversion,deduced_return_type_of_user-defined'></a></span>A conversion function template shall not have a
deduced return type (<a href='dcl.spec.auto'>[dcl.spec.auto]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.example-1' class='example'>[&nbsp;<a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> S <span class='curlybracket'>{</span>
  <span class='keyword'>operator</span> <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>10</span>; <span class='curlybracket'>}</span>      <span class='comment'>// OK</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
  <span class='keyword'>operator</span> <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>1.2</span>; <span class='curlybracket'>}</span>     <span class='comment'>// error: conversion function template</span>
<span class='curlybracket'>}</span>;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='footnote' id='footnote-106'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-106'>106)</a></div><div id='footnote-106.sentence-1' class='sentence'>These conversions are considered
as standard conversions for the purposes of overload resolution (<a href='over.best.ics'>[over.best.ics]</a>, <a href='over.ics.ref'>[over.ics.ref]</a>) and therefore initialization (<a href='dcl.init'>[dcl.init]</a>) and explicit casts (<a href='expr.static.cast'>[expr.static.cast]</a>)<a class='hidden_link' href='#footnote-106.sentence-1'>.</a></div> <div id='footnote-106.sentence-2' class='sentence'>A conversion to <span class='texttt'><span class='keyword'>void</span></span> does not invoke any conversion function (<a href='expr.static.cast'>[expr.static.cast]</a>)<a class='hidden_link' href='#footnote-106.sentence-2'>.</a></div> <div id='footnote-106.sentence-3' class='sentence'>Even though never directly called to perform a conversion,
such conversion functions can be declared and can potentially
be reached through a call to a virtual conversion function in a base class<a class='hidden_link' href='#footnote-106.sentence-3'>.</a></div> <a href='#footnoteref-106'>⮥</a></div></div></body></html>