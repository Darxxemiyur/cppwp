<!DOCTYPE html><html lang='en'><head><title>[temp.dep.candidate]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>13</a> Templates <a class='abbr_ref' href='./#temp'>[temp]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>13.8</a> Name resolution <a class='abbr_ref' href='temp.res#temp.dep.candidate'>[temp.res]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>13.8.5</a> Dependent name resolution <a class='abbr_ref' href='temp.dep.res#temp.dep.candidate'>[temp.dep.res]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>13.8.5.2</a> Candidate functions <a class='abbr_ref'>[temp.dep.candidate]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/templates.tex#L5706'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':functions,candidate'></a>For a function call where the <a href='expr.post.general#nt:postfix-expression' title='7.6.1.1&emsp;General&emsp;[expr.post.general]'><span id='ntref:postfix-expression'><span class='textsf'><span class='textit'>postfix-expression</span></span></span></a> is a
dependent name,
the candidate functions are found using the usual lookup
rules from the template definition context
(<a href='basic.lookup.unqual' title='6.5.2&emsp;Unqualified name lookup'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>unqual]</a>, <a href='basic.lookup.argdep' title='6.5.3&emsp;Argument-dependent name lookup'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>argdep]</a>)<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<a class='note_link' href='#note-1'><span class='textit'>Note&nbsp;1</span></a><span class='textit'>:</span> <div id='1.sentence-2' class='sentence'>For the part of the lookup using associated namespaces (<a href='basic.lookup.argdep' title='6.5.3&emsp;Argument-dependent name lookup'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>argdep]</a>),
function declarations found in the template instantiation context
are found by this lookup, as described in <a href='basic.lookup.argdep' title='6.5.3&emsp;Argument-dependent name lookup'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>argdep]</a><a class='hidden_link' href='#1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='1.sentence-3' class='sentence'>
If
the call would be ill-formed or would find a better match had the lookup
within the associated namespaces considered all the function declarations with
external linkage introduced in those namespaces in all translation units,
not just considering those declarations found in the template definition and
template instantiation contexts, then the program has undefined behavior<a class='hidden_link' href='#1.sentence-3'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/templates.tex#L5725'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<a class='example_link' href='#example-1'><span class='textit'>Example&nbsp;1</span></a><span class='textit'>:</span> <p>Source file <span class='texttt'><span class='literal'>"X.h"</span></span>:<span class='codeblock'><span class='keyword'>namespace</span> Q <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> X <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Source file <span class='texttt'><span class='literal'>"G.h"</span></span>:<span class='codeblock'><span class='keyword'>namespace</span> Q <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> g_impl<span class='parenthesis'>(</span>X, X<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>M1</span>:<span class='codeblock'><span class='keyword'>module</span>;
<span class='preprocessordirective'>#include</span> <span class='literal'>"X.h"</span>
<span class='preprocessordirective'>#include</span> <span class='literal'>"G.h"</span>
<span class='keyword'>export</span> <span class='keyword'>module</span> M1;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> g<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  g_impl<span class='parenthesis'>(</span>t, Q<span class='operator'>::</span>X<span class='curlybracket'>{</span> <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;   <span class='comment'>// ADL in definition context finds <span class='tcode_in_codeblock'>Q&#x200b;::&#x200b;g_&shy;impl</span>, <span class='tcode_in_codeblock'>g_&shy;impl</span> not discarded</span>
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>M2</span>:<span class='codeblock'><span class='keyword'>module</span>;
<span class='preprocessordirective'>#include</span> <span class='literal'>"X.h"</span>
<span class='keyword'>export</span> <span class='keyword'>module</span> M2;
<span class='keyword'>import</span> M1;
<span class='keyword'>void</span> h<span class='parenthesis'>(</span>Q<span class='operator'>::</span>X x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
   g<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>;                <span class='comment'>// OK</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/templates.tex#L5761'>#</a></div><div class='texpara'><div id='example-2' class='example'><div class='texpara'>[<a class='example_link' href='#example-2'><span class='textit'>Example&nbsp;2</span></a><span class='textit'>:</span> <p>Module interface unit of <span class='texttt'>Std</span>:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> Std;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> Iter<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> indirect_swap<span class='parenthesis'>(</span>Iter lhs, Iter rhs<span class='parenthesis'>)</span>
<span class='curlybracket'>{</span>
  swap<span class='parenthesis'>(</span><span class='operator'>*</span>lhs, <span class='operator'>*</span>rhs<span class='parenthesis'>)</span>;     <span class='comment'>// <span class='tcode_in_codeblock'>swap</span> not found by unqualified lookup, can be found only via ADL</span>
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>M</span>:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> M;
<span class='keyword'>import</span> Std;

<span class='keyword'>struct</span> S <span class='curlybracket'>{</span> <span class='comment'>/* ...*/</span> <span class='curlybracket'>}</span>;
<span class='keyword'>void</span> swap<span class='parenthesis'>(</span>S<span class='operator'>&amp;</span>, S<span class='operator'>&amp;</span><span class='parenthesis'>)</span>;      <span class='comment'>// #1</span>

<span class='keyword'>void</span> f<span class='parenthesis'>(</span>S<span class='operator'>*</span> p, S<span class='operator'>*</span> q<span class='parenthesis'>)</span>
<span class='curlybracket'>{</span>
  indirect_swap<span class='parenthesis'>(</span>p, q<span class='parenthesis'>)</span>;  <span class='comment'>// finds #1 via ADL in instantiation context</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/templates.tex#L5786'>#</a></div><div class='texpara'><div id='example-3' class='example'><div class='texpara'>[<a class='example_link' href='#example-3'><span class='textit'>Example&nbsp;3</span></a><span class='textit'>:</span> <p>Source file <span class='texttt'><span class='literal'>"X.h"</span></span>:<span class='codeblock'><span class='keyword'>struct</span> X <span class='curlybracket'>{</span> <span class='comment'>/* ... */</span> <span class='curlybracket'>}</span>;
X <span class='keyword'>operator</span><span class='operator'>+</span><span class='parenthesis'>(</span>X, X<span class='parenthesis'>)</span>;
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>F</span>:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> F;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  t <span class='operator'>+</span> t;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>M</span>:<span class='codeblock'><span class='keyword'>module</span>;
<span class='preprocessordirective'>#include</span> <span class='literal'>"X.h"</span>
<span class='keyword'>export</span> <span class='keyword'>module</span> M;
<span class='keyword'>import</span> F;
<span class='keyword'>void</span> g<span class='parenthesis'>(</span>X x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  f<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>;             <span class='comment'>// OK: instantiates <span class='tcode_in_codeblock'>f</span> from <span class='tcode_in_codeblock'>F</span>,</span>
                    <span class='comment'>// <span class='tcode_in_codeblock'>operator+</span> is visible in instantiation context</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/88ec08948c822ecddba35e33c556817ebe32f607/source/templates.tex#L5813'>#</a></div><div class='texpara'><div id='example-4' class='example'><div class='texpara'>[<a class='example_link' href='#example-4'><span class='textit'>Example&nbsp;4</span></a><span class='textit'>:</span> <p>Module interface unit of <span class='texttt'>A</span>:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> A;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  cat<span class='parenthesis'>(</span>t, t<span class='parenthesis'>)</span>;            <span class='comment'>// #1</span>
  dog<span class='parenthesis'>(</span>t, t<span class='parenthesis'>)</span>;            <span class='comment'>// #2</span>
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>B</span>:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> B;
<span class='keyword'>import</span> A;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T, <span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> g<span class='parenthesis'>(</span>T t, U u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  f<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Source file <span class='texttt'><span class='literal'>"foo.h"</span></span>, not an importable header:<span class='codeblock'><span class='keyword'>struct</span> foo <span class='curlybracket'>{</span>
  <span class='keyword'>friend</span> <span class='keyword'>int</span> cat<span class='parenthesis'>(</span>foo, foo<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>int</span> dog<span class='parenthesis'>(</span>foo, foo<span class='parenthesis'>)</span>;
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>C1</span>:<span class='codeblock'><span class='keyword'>module</span>;
<span class='preprocessordirective'>#include</span> <span class='literal'>"foo.h"</span>        <span class='comment'>// <span class='tcode_in_codeblock'>dog</span> not referenced, discarded</span>
<span class='keyword'>export</span> <span class='keyword'>module</span> C1;
<span class='keyword'>import</span> B;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> h<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  g<span class='parenthesis'>(</span>foo<span class='curlybracket'>{</span> <span class='curlybracket'>}</span>, t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Translation unit:<span class='codeblock'><span class='keyword'>import</span> C1;
<span class='keyword'>void</span> i<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
   h<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;                <span class='comment'>// error: <span class='tcode_in_codeblock'>dog</span> not found at #2</span>
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Importable header <span class='texttt'><span class='literal'>"bar.h"</span></span>:<span class='codeblock'><span class='keyword'>struct</span> bar <span class='curlybracket'>{</span>
  <span class='keyword'>friend</span> <span class='keyword'>int</span> cat<span class='parenthesis'>(</span>bar, bar<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>int</span> dog<span class='parenthesis'>(</span>bar, bar<span class='parenthesis'>)</span>;
</span></div><div class='texpara'><p>Module interface unit of <span class='texttt'>C2</span>:<span class='codeblock'><span class='keyword'>module</span>;
<span class='preprocessordirective'>#include</span> <span class='literal'>"bar.h"</span>        <span class='comment'>// imports header unit <span class='tcode_in_codeblock'>"bar.h"</span></span>
<span class='keyword'>export</span> <span class='keyword'>module</span> C2;
<span class='keyword'>import</span> B;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> j<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  g<span class='parenthesis'>(</span>bar<span class='curlybracket'>{</span> <span class='curlybracket'>}</span>, t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Translation unit:<span class='codeblock'><span class='keyword'>import</span> C2;
<span class='keyword'>void</span> k<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
   j<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;                <span class='comment'>// OK, <span class='tcode_in_codeblock'>dog</span> found in instantiation context:</span>
                        <span class='comment'>// visible at end of module interface unit of <span class='tcode_in_codeblock'>C2</span></span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>